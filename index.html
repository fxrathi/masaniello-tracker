<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Masaniello 2/10 Tracker (Dynamic)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; text-align: center; }
    .flex { display: flex; flex-direction: column; align-items: center; gap: 12px; }
    .stat { font-size: 18px; margin: 8px 0; }
    .btn { font-size: 28px; padding: 20px 36px; border: none; border-radius: 8px; margin: 8px; width: 120px;}
    .win { background: #37c84a; color: white;}
    .loss { background: #f44336; color: white;}
    .reset { background: #555; color: white; font-size: 18px;}
    input[type=number] { font-size: 18px; padding: 6px; width: 100px; }
    label { font-size: 16px; }
    .inputs { margin-bottom: 12px; }
  </style>
</head>
<body>
  <h2>Masaniello 2/10 (Objective:WIN logic)</h2>
  <div class="inputs flex">
    <div>
      <label>Starting Balance: $</label>
      <input id="balance" type="number" min="1" step="0.01" value="500">
    </div>
    <div>
      <label>% Risk Per Cycle: </label>
      <input id="riskPct" type="number" min="1" max="100" step="1" value="20">
      <span>%</span>
    </div>
    <button class="reset" onclick="resetAll(true)">Apply Settings</button>
  </div>
  <div class="stat" id="cycleStat"></div>
  <div class="flex">
    <button class="btn win" onclick="processResult(true)">‚úÖ WIN</button>
    <button class="btn loss" onclick="processResult(false)">‚ùå LOSS</button>
  </div>
  <div class="stat" id="status"></div>
  <button class="reset" onclick="resetAll(false)">üîÑ RESET TRACKER</button>

  <script>
    // --- CONFIG ---
    const tradesPerCycle = 10;
    const targetWins = 2;
    const payout = 1.85;

    // --- STATE ---
    let totalBalance = 500;
    let riskPct = 20;
    let cycle = 1;
    let wins = 0;
    let losses = 0;
    let tradeNumber = 1;
    let cycleWins = 0;
    let cycleProfit = 0;
    let riskAmount = 100;
    let stakes = [];

    // --- MASANIELLO LOGIC ---
    function binomial(n, k) {
      // n choose k
      if (k < 0 || k > n) return 0;
      let res = 1;
      for (let i = 1; i <= k; i++) {
        res *= (n - (k - i));
        res /= i;
      }
      return res;
    }

    function nextStake(remainingTrades, remainingWins, currentProfit) {
      if (remainingWins === 0) return 0; // already reached target
      // Masaniello logic: dynamically solve for next stake
      // S = (riskAmount + abs(currentProfit)) / (binomial(remainingTrades, remainingWins) * payout)
      // This is a simplification for 2-wins-in-10. For production, use recursion or a table.
      let combos = binomial(remainingTrades, remainingWins);
      if (combos === 0) combos = 1;
      let stake = (riskAmount - currentProfit) / (combos * payout);
      return Math.max(0, +stake.toFixed(2));
    }

    function getNextStake() {
      // How many trades left? How many wins needed?
      let tradesLeft = tradesPerCycle - (wins + losses);
      let winsLeft = targetWins - wins;
      let profitSoFar = cycleProfit;
      if (winsLeft <= 0 || tradesLeft <= 0) return 0;
      return nextStake(tradesLeft, winsLeft, profitSoFar);
    }

    // --- APP LOGIC ---
    function updateDisplay() {
      document.getElementById('cycleStat').innerHTML = `
        <b>Cycle #${cycle}</b> &nbsp;|&nbsp; 
        <b>Cycle Wins:</b> ${cycleWins} &nbsp;|&nbsp;
        <b>Balance:</b> $${totalBalance.toFixed(2)}
      `;
      document.getElementById('status').innerHTML = `
        <b>Trade:</b> ${tradeNumber} / ${tradesPerCycle} &nbsp;|&nbsp;
        <b>Wins:</b> ${wins} &nbsp;|&nbsp;
        <b>Losses:</b> ${losses} <br>
        <b>Next Bet:</b> $${getNextStake()}
      `;
    }

    function processResult(isWin) {
      if (wins >= targetWins || (wins + losses) >= tradesPerCycle) {
        alert('Cycle is over. Please reset for a new cycle.');
        return;
      }
      let stake = getNextStake();
      if (isWin) {
        wins++;
        cycleProfit += stake * (payout - 1); // Net profit from this win
      } else {
        losses++;
        cycleProfit -= stake;
      }
      tradeNumber++;
      if (wins >= targetWins || (wins + losses) >= tradesPerCycle) {
        // End of cycle
        totalBalance += cycleProfit;
        if (wins >= targetWins) {
          cycleWins++;
          alert(`üéâ Cycle WON! Profit: $${cycleProfit.toFixed(2)} added.`);
        } else {
          alert(`Cycle ended. Not enough wins. P/L: $${cycleProfit.toFixed(2)}.`);
        }
        resetCycleOnly();
      }
      updateDisplay();
    }

    function resetCycleOnly() {
      cycle++;
      wins = 0;
      losses = 0;
      tradeNumber = 1;
      cycleProfit = 0;
      riskAmount = totalBalance * (riskPct / 100);
    }

    function resetAll(applyNewSettings) {
      // If "Apply Settings" was clicked, update values from inputs
      if (applyNewSettings) {
        let bal = parseFloat(document.getElementById('balance').value);
        let pct = parseFloat(document.getElementById('riskPct').value);
        if (isNaN(bal) || bal <= 0 || isNaN(pct) || pct <= 0 || pct > 100) {
          alert('Please enter valid starting balance and % risk.');
          return;
        }
        totalBalance = bal;
        riskPct = pct;
      }
      cycle = 1;
      cycleWins = 0;
      resetCycleOnly();
      updateDisplay();
    }

    // --- INIT ---
    resetAll(true);
  </script>
</body>
</html>
